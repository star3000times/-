# 程序模块与功能说明  

## 一、核心程序与流程  
### 1. 启动与核心功能  
执行 `main.py` 启动主程序，其会通过 `mqtthandler` 模块建立 MQTT 连接，发送 MQTT 请求并与服务器交互：  
- **参数交互**：支持接收服务器下发的参数更新指令，也可主动上报本地配置。  
- **结果上报**：将指示灯识别（`led_detector.py`）、仪表识别（`meter_detector.py`）的检测结果，通过 MQTT 发送至服务器。  


## 二、模块分工  
| 模块文件                | 功能说明                     |  
|-------------------------|------------------------------|  
| `main.py`               | 主程序入口，调度各模块运行   |  
| `configloader.py`       | 加载 `config.json` 中的识别参数 |  
| `config.json`           | 存储识别算法、设备配置等参数  |  
| `mqtthandler.py`        | 封装 MQTT 连接、消息收发逻辑  |  
| `led_detector.py`       | 指示灯识别算法实现           |  
| `meter_detector.py`     | 仪表数据识别算法实现         |  
| `video_ffmpeg.py`       | 视频流采集、预处理（依赖 FFmpeg） |  
| `rtmp_pusher.py`        | 视频流编码并推送到 SRS 服务器 |  


## 三、调试与验证工具  
### 1. 数据调试  
- **MQTT 消息**：用 **MQTTX 软件** 订阅/发布主题，验证参数更新、检测结果上报流程。  
- **视频流**：推流后通过 SRS 服务器（或支持 RTMP 的播放器）拉流，查看视频识别效果。  


### 典型流程示例  
1. 修改 `config.json` 调整识别参数 → `configloader.py` 加载新配置。  
2. `main.py` 启动后，`mqtthandler.py` 连接 MQTT 服务器 → 发送设备状态、接收指令。  
3. `video_ffmpeg.py` 处理视频流 → 调用 `led_detector.py`/`meter_detector.py` 分析 → 结果通过 MQTT 上报，后经 `rtmp_pusher.py` 推流至 SRS。  


通过模块化分工，可快速定位功能（如调试识别算法仅需关注 `led_detector.py`/`meter_detector.py`），结合 MQTTX + SRS 能高效验证端到端流程 。




